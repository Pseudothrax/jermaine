if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this==null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>0){e=Number(arguments[1]);if(e!=e){e=0}else{if(e!=0&&e!=Infinity&&e!=-Infinity){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}}(function(b){var a=function(f,c,h){var j=/^([a-zA-Z]+)(\.[a-zA-Z]*)*$/,g,e,d;if(f.match(j)===null||f==="window"){throw new Error("namespace: "+f+" is a malformed namespace string")}if(c!==undefined&&h===undefined){if(typeof(c)==="function"){h=c;c=undefined}else{if(typeof(c)==="object"){throw new Error("namespace: if second argument exists, final function argument must exist")}else{if(typeof(c)!=="object"){throw new Error("namespace: second argument must be an object of aliased local namespaces")}}}}else{if(typeof(c)!=="object"&&typeof(h)==="function"){throw new Error("namespace: second argument must be an object of aliased local namespaces")}}g=f.split(".");if(g[0]==="window"){e=window}else{e=(window[g[0]]===undefined)?window[g[0]]={}:window[g[0]]}if(h!==undefined&&typeof(h)!=="function"){throw new Error("namespace: last parameter must be a function that accepts a namespace parameter")}for(d=1;d<g.length;d=d+1){if(e[g[d]]===undefined){e[g[d]]={}}e=e[g[d]]}if(c===undefined&&h){h(e)}else{if(h){for(d in c){if(c.hasOwnProperty(d)){c[d]=a(c[d])}}h.call(c,e)}}return e};return a(b,function(c){c.namespace=a})}("window.jermaine.util"));window.jermaine.util.namespace("window.jermaine.util",function(a){var b=function(){var d=this,c={};this.on=function(e,f){if(typeof(e)!=="string"){throw new Error("EventEmitter: first argument to 'on' should be a string")}if(typeof(f)!=="function"){throw new Error("EventEmitter: second argument to 'on' should be a function")}if(!c[e]){c[e]=[]}c[e].push(f);return d};this.addListener=this.on;this.once=function(e,h){var g=function(){h(arguments);d.removeListener(e,g)};d.on(e,g);return d};this.removeListener=function(f,g){var e;if(typeof(f)!=="string"){throw new Error("EventEmitter: first parameter to removeListener method must be a string representing an event")}if(typeof(g)!=="function"){throw new Error("EventEmitter: second parameter must be a function to remove as an event listener")}e=c[f].indexOf(g);if(e!==-1){c[f].splice(e,1)}return d};this.removeAllListeners=function(e){if(typeof(e)!=="string"){throw new Error("EventEmitter: parameter to removeAllListeners should be a string representing an event")}if(c[e]!==undefined){c[e]=[]}return d};this.setMaxListeners=function(e){return d};this.listeners=function(e){if(typeof(e)!=="string"){throw new Error("EventEmitter: listeners method must be called with the name of an event")}else{if(c[e]===undefined){return[]}}return c[e]};this.emit=function(f,g){var e,h;if(arguments.length>1){h=[]}for(e=1;e<arguments.length;++e){h.push(arguments[e])}if(c[f]!==undefined){for(e=0;e<c[f].length;e=e+1){c[f][e].apply(this,h)}}};return d};a.EventEmitter=b});window.jermaine.util.namespace("window.jermaine",function(c){var d=this,b,a={};b=function(e){var f=function(h){var g,j={},i;g=e.call(j,h);if(!g){i=j.message||"validator failed with parameter "+h;throw new Error(i)}return g};return f};b.addValidator=function(f,e){if(f===undefined||typeof(f)!=="string"){throw new Error("addValidator requires a name to be specified as the first parameter")}if(e===undefined||typeof(e)!=="function"){throw new Error("addValidator requires a function as the second parameter")}if(a[f]===undefined){a[f]=function(g){return new b(function(j){var i={actual:j,param:j},h=e.call(i,g);this.message=i.message;return h})}}else{throw new Error("Validator '"+f+"' already defined")}};b.getValidator=function(f){var e;if(f===undefined){throw new Error("Validator: getValidator method requires a string parameter")}else{if(typeof(f)!=="string"){throw new Error("Validator: parameter to getValidator method must be a string")}}e=a[f];if(e===undefined){throw new Error("Validator: '"+f+"' does not exist")}return e};b.validators=function(){var f,e=[];for(f in a){if(a.hasOwnProperty(f)){e.push(f)}}return e};b.addValidator("isGreaterThan",function(e){this.message=this.param+" should be greater than "+e;return this.param>e});b.addValidator("isLessThan",function(e){this.message=this.param+" should be less than "+e;return this.param<e});b.addValidator("isA",function(f){var e=["string","number","boolean","function","object"];if(typeof(f)==="string"&&e.indexOf(f)>-1){this.message=this.param+" should be a "+f;return typeof(this.param)===f}else{if(f==="integer"){if(this.param.toString!==undefined){this.message=this.param.toString()+" should be an integer"}else{this.message="parameter should be an integer"}return(typeof(this.param)==="number")&&(parseInt(this.param,10)===this.param)}else{if(typeof(f)==="string"){throw new Error("Validator: isA accepts a string which is one of "+e)}else{throw new Error("Validator: isA only accepts a string for a primitive types for the time being")}}}});a.isAn=a.isA;b.addValidator("isOneOf",function(e){this.message=this.param+" should be one of the set: "+e;return e.indexOf(this.param)>-1});c.Validator=b});window.jermaine.util.namespace("window.jermaine",function(b){var a={};var c=function(g){var j=[],n=this,o="invalid setter call for "+g,k,l,m,f,d,q=false,e,p,r=window.jermaine.AttrList,h=window.jermaine.Validator,s=window.jermaine.util.EventEmitter;e=function(i){for(m=0;m<j.length;++m){j[m](i)}return true};l=function(){return(typeof(k)==="function")?k():k};if(g===undefined||typeof(g)!=="string"){throw new Error("Attr: constructor requires a name parameter which must be a string")}this.validatesWith=function(i){if(typeof(i)==="function"){j.push(new h(i));return this}else{throw new Error("Attr: validator must be a function")}};this.defaultsTo=function(i){k=i;return this};this.isImmutable=function(){q=true;return this};this.isMutable=function(){q=false;return this};this.name=function(){return g};this.clone=function(){var t=(this instanceof r)?new r(g):new c(g),u;for(u=0;u<j.length;++u){t.validatesWith(j[u])}t.defaultsTo(k);if(q){t.isImmutable()}return t};this.and=this;this.which=this;this.validator=function(){return e};this.addTo=function(v){var t,u,i;if(!v||typeof(v)!=="object"){throw new Error("Attr: addAttr method requires an object parameter")}i=l();if(i!==undefined&&e(i)){t=i}else{if(i!==undefined&&!e(i)){throw new Error("Attr: Default value of "+i+" does not pass validation for "+g)}}v[g]=function(y){var z=[],w=true,x;if(y!==undefined){if(q&&t!==undefined){throw new Error("cannot set the immutable property "+g+" after it has been set")}else{if(!e(y)){throw new Error(o)}else{if((v instanceof s||v.on&&v.emit)&&y.on){if(t&&t.listeners("change").length>0&&typeof(u)==="function"){t.removeListener("change",u)}u=function(A){for(x=0;x<A.length&&w;++x){if(A[x].origin===v){w=false}}if(w&&A.push){A.push({key:g,origin:v});v.emit("change",A)}};y.on("change",u)}t=y;z.push({key:g,value:y,origin:v});if((v instanceof s||v.on&&v.emit)){v.emit("change",z)}}}return v}else{return t}}};d=function(i){n[i]=function(t){j.push(h.getValidator(i)(t));return n}};for(m=0;m<h.validators().length;++m){d(h.validators()[m])}};b.Attr=c});window.jermaine.util.namespace("window.jermaine",function(a){function b(c){var e=this;a.Attr.call(this,c);var d=function(g,f){return function(){return g[f].apply(g,arguments)}};this.validateWith=this.validatesWith;this.defaultsTo=function(){};this.isImmutable=function(){};this.isMutable=function(){};this.eachOfWhich=this;this.addTo=function(h){var i,f=[],g={};if(!h||typeof(h)!=="object"){throw new Error("AttrList: addTo method requires an object parameter")}else{g.pop=d(f,"pop");g.add=function(j){if((e.validator())(j)){f.push(j);return this}else{throw new Error(e.errorMessage())}};g.at=function(j){if(j<0||j>=this.size()){throw new Error("AttrList: Index out of bounds")}return f[j]};g.get=g.at;g.size=function(){return f.length};h[c]=function(){return g}}}}b.prototype=new window.jermaine.Attr(name);a.AttrList=b});window.jermaine.util.namespace("window.jermaine",function(a){var b=function(c,d){if(!c||typeof(c)!=="string"){throw new Error("Method: constructor requires a name parameter which must be a string")}else{if(!d||typeof(d)!=="function"){throw new Error("Method: second parameter must be a function")}}this.addTo=function(e){if(!e||typeof(e)!=="object"){throw new Error("Method: addTo method requires an object parameter")}e[c]=d}};a.Method=b});window.jermaine.util.namespace("window.jermaine",function(a){function b(y){var j=this,t={},k={},s,o,u,g=true,e=[],q=[],v=[],d=a.Method,x=a.Attr,n=a.AttrList,i=a.util.EventEmitter,h,z,m,l,c,w=function(){},r=function(){},f=function(){if(g){m()}return r.apply(this,arguments)};if(arguments.length>1){y=arguments[arguments.length-1]}if(y&&typeof(y)==="function"){f=new b();y.call(f);return f}else{if(y){throw new Error("Model: specification parameter must be a function")}}var p=function(C,B){var E,A,D;E=C==="Attr"?x:n;A=C==="Attr"?"hasA":"hasMany";g=true;if(typeof(B)==="string"){D=new E(B);k[B]=D;return D}else{throw new Error("Model: "+A+" parameter must be a string")}};h=function(C,B){var A;if(typeof(B)!=="string"){throw new Error("Model: expected string argument to "+C+" method, but recieved "+B)}A=C==="attribute"?k[B]:t[B];if(A===undefined){throw new Error("Model: "+C+" "+B+" does not exist!")}return A};z=function(C){var B,D=[],A=C==="attributes"?k:t;for(B in A){if(A.hasOwnProperty(B)){D.push(B)}}return D};m=function(B){var E=this,C,A,D;f.validate();r=function(){var I=this,G,H,F;if(!(this instanceof f)){throw new Error("Model: instances must be created using the new operator")}F=function(M,L){var K=L==="attributes"?k:t,J;for(J in K){if(K.hasOwnProperty(J)){if(K===k&&l){K[J].isImmutable()}K[J].addTo(M)}}};c=new i();this.on=c.on;this.emit=c.emit;F(this,"attributes");F(this,"methods");if(s!==undefined){this.toString=s}if(arguments.length>0){if(arguments.length<e.length){D="Constructor requires ";for(G=0;G<e.length;++G){D+=e[G];D+=G===e.length-1?"":", "}D+=" to be specified";throw new Error(D)}else{for(G=0;G<arguments.length;++G){H=G<e.length?e[G]:q[G-e.length];if(f.attribute(H) instanceof n){if(Object.prototype.toString.call(arguments[G])!=="[object Array]"){throw new Error("Model: Constructor requires 'names' attribute to be set with an Array")}else{for(A=0;A<arguments[G].length;++A){this[H]().add(arguments[G][A])}}}else{this[H](arguments[G])}}}}w.call(this)};return r};f.hasA=function(A){return p("Attr",A)};f.hasAn=f.hasA;f.hasSome=f.hasA;f.hasMany=function(A){return p("AttrList",A)};f.isA=function(C){var B,A,E,D;g=true;D=function(G){var F,H=new b();for(F in H){if(H.hasOwnProperty(F)&&typeof(G[F])!==typeof(H[F])){return false}}return true};if(typeof(C)!=="function"||!D(C)){throw new Error("Model: parameter sent to isA function must be a Model")}if(v.length===0){v.push(C)}else{throw new Error("Model: Model only supports single inheritance at this time")}A=v[0].attributes();for(B=0;B<A.length;++B){if(k[A[B]]===undefined){k[A[B]]=v[0].attribute(A[B]).clone();k[A[B]].isMutable()}}E=v[0].methods();for(B=0;B<E.length;++B){if(t[E[B]]===undefined){t[E[B]]=v[0].method(E[B])}}for(B=0;B<v.length;B++){f.prototype=new v[B]()}};f.isAn=f.isA;f.parent=function(){return v[0].apply(this,arguments)};f.attribute=function(A){return h("attribute",A)};f.attributes=function(){return z("attributes")};f.method=function(A){return h("method",A)};f.methods=function(){return z("methods")};f.isBuiltWith=function(){var A=false,B;g=true;e=[];q=[];for(B=0;B<arguments.length;++B){if(typeof(arguments[B])==="string"&&arguments[B].charAt(0)!=="%"){if(A){throw new Error("Model: isBuiltWith requires parameters preceded with a % to be the final parameters before the optional function")}else{e.push(arguments[B])}}else{if(typeof(arguments[B])==="string"&&arguments[B].charAt(0)==="%"){A=true;q.push(arguments[B].slice(1))}else{if(typeof(arguments[B])==="function"&&B===arguments.length-1){w=arguments[B]}else{throw new Error("Model: isBuiltWith parameters must be strings except for a function as the optional final parameter")}}}}};f.isImmutable=function(){l=true};f.looksLike=function(A){g=true;s=A};f.respondsTo=function(B,C){var A=new d(B,C);g=true;t[B]=A};f.validate=function(){var C,B=this.attributes(),A=this.methods();for(C=0;C<e.length;++C){try{this.attribute(e[C])}catch(D){throw new Error(e[C]+", specified in the isBuiltWith method, is not an attribute")}}for(C=0;C<q.length;++C){try{this.attribute(q[C])}catch(D){throw new Error(q[C]+", specified in the isBuiltWith method, is not an attribute")}}for(C=0;C<B.length;C++){if(A.indexOf(B[C])>-1){throw new Error("Model: invalid model specification to "+B[C]+" being both an attribute and method")}}if(l){for(C=0;C<B.length;C++){if(e.indexOf(B[C])<0){throw new Error("immutable objects must have all attributes required in a call to isBuiltWith")}}}g=false};return f}a.Model=b});